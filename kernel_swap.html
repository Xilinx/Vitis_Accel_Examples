

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Vector Add - Vector Multiplication for XPR Devices &mdash; SCOUT Git Examples&#39; Documentation 2019.2 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Vector Addition ~ Asymmetrical Multiple Compute Units" href="multiple_cus_asymmetrical.html" />
    <link rel="prev" title="host_global_5.0_shell" href="host_global_bandwidth_5.0_shell.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> SCOUT Git Examples' Documentation
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="prerequisites.html">Prerequisites</a></li>
<li class="toctree-l1"><a class="reference internal" href="platforms.html">Supported Platforms</a></li>
<li class="toctree-l1"><a class="reference internal" href="compile_execute.html">Compilation and Execution</a></li>
<li class="toctree-l1"><a class="reference internal" href="cloud.html">Cloud Execution</a></li>
<li class="toctree-l1"><a class="reference internal" href="support.html">Support</a></li>
</ul>
<p class="caption"><span class="caption-text">Category of Examples</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="hello_world.html">Hello World</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="host.html">Host</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="concurrent_kernel_execution.html">Concurrent Kernel Execution</a></li>
<li class="toctree-l2"><a class="reference internal" href="copy_buffer.html">Copy Buffer</a></li>
<li class="toctree-l2"><a class="reference internal" href="data_transfer.html">Data Transfer</a></li>
<li class="toctree-l2"><a class="reference internal" href="device_query.html">Device Query</a></li>
<li class="toctree-l2"><a class="reference internal" href="device_query_cpp.html">Device Query (CPP)</a></li>
<li class="toctree-l2"><a class="reference internal" href="errors.html">Error Handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="errors_cpp.html">Error Handling (CPP)</a></li>
<li class="toctree-l2"><a class="reference internal" href="hbm_bandwidth.html">HBM Bandwidth</a></li>
<li class="toctree-l2"><a class="reference internal" href="hbm_simple.html">HBM Simple Vector Addition</a></li>
<li class="toctree-l2"><a class="reference internal" href="host_global_bandwidth.html">host_global</a></li>
<li class="toctree-l2"><a class="reference internal" href="host_global_bandwidth_5.0_shell.html">host_global_5.0_shell</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Vector Add - Vector Multiplication for XPR Devices</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#supported-platforms">SUPPORTED PLATFORMS</a></li>
<li class="toctree-l3"><a class="reference internal" href="#design-files">DESIGN FILES</a></li>
<li class="toctree-l3"><a class="reference internal" href="#command-line-arguments">COMMAND LINE ARGUMENTS</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="multiple_cus_asymmetrical.html">Vector Addition ~ Asymmetrical Multiple Compute Units</a></li>
<li class="toctree-l2"><a class="reference internal" href="multiple_devices.html">Multiple FPGA Devices Execution Concurrently</a></li>
<li class="toctree-l2"><a class="reference internal" href="multiple_process.html">Multiple Process</a></li>
<li class="toctree-l2"><a class="reference internal" href="overlap.html">Overlap Host and HLS kernels</a></li>
<li class="toctree-l2"><a class="reference internal" href="streaming_host_bandwidth.html">Host Streaming Bandwidth</a></li>
<li class="toctree-l2"><a class="reference internal" href="streaming_k2k.html">Stream Kernel to Kernel Vector Addition and Multiplication</a></li>
<li class="toctree-l2"><a class="reference internal" href="streaming_k2k_mm.html">Stream Kernel to Kernel Vector Addition and Multiplication</a></li>
<li class="toctree-l2"><a class="reference internal" href="streaming_mm_mixed.html">Stream Vector Addition with OpenCL Buffers</a></li>
<li class="toctree-l2"><a class="reference internal" href="streaming_multi_cus.html">Stream Vector Addition (Multiple Compute Units)</a></li>
<li class="toctree-l2"><a class="reference internal" href="streaming_simple.html">Stream Vector Addition</a></li>
<li class="toctree-l2"><a class="reference internal" href="sub_devices.html">Sub Devices</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="sysopt.html">System Optimizations</a></li>
<li class="toctree-l1"><a class="reference internal" href="cpp.html">C++ Kernels</a></li>
<li class="toctree-l1"><a class="reference internal" href="rtl.html">RTL Kernels</a></li>
<li class="toctree-l1"><a class="reference internal" href="ocl.html">OpenCL Kernels</a></li>
<li class="toctree-l1"><a class="reference internal" href="apps.html">Applications</a></li>
</ul>
<p class="caption"><span class="caption-text">Common Utilities</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="common.html">Common Files</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">SCOUT Git Examples' Documentation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
          <li><a href="host.html">Host</a> &raquo;</li>
        
      <li>Vector Add - Vector Multiplication for XPR Devices</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/kernel_swap.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="vector-add-vector-multiplication-for-xpr-devices">
<h1>Vector Add - Vector Multiplication for XPR Devices<a class="headerlink" href="#vector-add-vector-multiplication-for-xpr-devices" title="Permalink to this headline">¶</a></h1>
<p>This example shows how host can swap the kernels and share same buffer
between two kernels which are exist in separate binary containers.
Dynamic platforms does not persist the buffer data so host has to
migrate data from device to host memory before swapping the next kernel.
After kernel swap, host has to migrate the buffer back to device.</p>
<p><strong>KEY CONCEPTS:</strong> Handling Buffer sharing across multiple binaries,
Multiple Kernel Binaries</p>
<p><strong>KEYWORDS:</strong> clEnqueueMigrateMemObjects(), CL_MIGRATE_MEM_OBJECT_HOST</p>
<p>This example shows how host can swap the kernels and share the same
buffer between two kernels which exist in separate binary containers.
All the SDx platforms do not persist the buffer data if device is
reprogrammed by different binary. So host has to migrate data from
device to host memory before swapping the next binary. After
re-programming the binary, host has to migrate the buffer back to device
for next kernel operation.</p>
<p>In design, host application first programs the device using binary
containing <code class="docutils literal notranslate"><span class="pre">krnl_vmult</span></code> and executes the operation.</p>
<p>Pointer <code class="docutils literal notranslate"><span class="pre">h_temp</span></code> in host is used to store the result of first kernel
and provide the data to next kernel operation.</p>
<p>During first kernel call, <code class="docutils literal notranslate"><span class="pre">d_mul</span></code> buffer is created using <code class="docutils literal notranslate"><span class="pre">h_temp</span></code>
buffer.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">cl</span><span class="o">::</span><span class="n">Buffer</span> <span class="n">d_mul</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">CL_MEM_USE_HOST_PTR</span> <span class="o">|</span> <span class="n">CL_MEM_READ_WRITE</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="o">*</span> <span class="n">LENGTH</span><span class="p">,</span> <span class="n">h_temp</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span> <span class="o">&amp;</span><span class="n">err</span><span class="p">);</span>
</pre></div>
</div>
<p>Once kernel finishes the operation, result of the kernel will be read
from device to host into <code class="docutils literal notranslate"><span class="pre">h_temp</span></code> buffer.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">q</span><span class="p">.</span><span class="n">enqueueMigrateMemObjects</span><span class="p">({</span><span class="n">d_mul</span><span class="p">},</span><span class="n">CL_MIGRATE_MEM_OBJECT_HOST</span><span class="p">);</span>
</pre></div>
</div>
<p>After this, Host is ready to reprogram the 2nd Binary.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">cl</span><span class="o">::</span><span class="n">Program</span> <span class="n">program</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">devices</span><span class="p">,</span> <span class="n">vadd_bins</span><span class="p">);</span>
</pre></div>
</div>
<p>After reprogramming with new binary, a new buffer <code class="docutils literal notranslate"><span class="pre">d_temp</span></code> will be
created using same <code class="docutils literal notranslate"><span class="pre">h_temp</span></code> host pointer.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">cl</span><span class="o">::</span><span class="n">Buffer</span> <span class="n">d_temp</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">CL_MEM_USE_HOST_PTR</span> <span class="o">|</span> <span class="n">CL_MEM_READ_ONLY</span><span class="p">,</span>   <span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="o">*</span> <span class="n">LENGTH</span><span class="p">,</span> <span class="n">h_temp</span><span class="p">.</span><span class="n">data</span><span class="p">());</span>
</pre></div>
</div>
<p>And data will be transfered from host to device for 2nd kernel’s
execution.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">q</span><span class="p">.</span><span class="n">enqueueMigrateMemObjects</span><span class="p">({</span><span class="n">d_temp</span><span class="p">},</span> <span class="mi">0</span><span class="cm">/* 0 means from host*/</span><span class="p">);</span>
</pre></div>
</div>
<div class="section" id="supported-platforms">
<h2>SUPPORTED PLATFORMS<a class="headerlink" href="#supported-platforms" title="Permalink to this headline">¶</a></h2>
<table class="docutils align-center">
<colgroup>
<col style="width: 38%" />
<col style="width: 32%" />
<col style="width: 30%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Platform</p></th>
<th class="head"><p>Board</p></th>
<th class="head"><p>Software Version</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>xilinx_u200_qdma</p></td>
<td><p>Xilinx Alveo U200</p></td>
<td><p>SCOUT 2019.2</p></td>
</tr>
<tr class="row-odd"><td><p>xilinx_u280_xdma</p></td>
<td><p>Xilinx Alveo U280</p></td>
<td><p>SCOUT 2019.2</p></td>
</tr>
<tr class="row-even"><td><p>xilinx_u250_qdma</p></td>
<td><p>Xilinx Alveo U250</p></td>
<td><p>SCOUT 2019.2</p></td>
</tr>
<tr class="row-odd"><td><p>xilinx_u200_xdma</p></td>
<td><p>Xilinx Alveo U200</p></td>
<td><p>SCOUT 2019.2</p></td>
</tr>
<tr class="row-even"><td><p>xilinx_u250_xdma</p></td>
<td><p>Xilinx Alveo U250</p></td>
<td><p>SCOUT 2019.2</p></td>
</tr>
<tr class="row-odd"><td><p>xilinx_u280-es1_xdma</p></td>
<td><p>Xilinx Alveo U280</p></td>
<td><p>SCOUT 2019.2</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="design-files">
<h2>DESIGN FILES<a class="headerlink" href="#design-files" title="Permalink to this headline">¶</a></h2>
<p>Application code is located in the src directory. Accelerator binary
files will be compiled to the xclbin directory. The xclbin directory is
required by the Makefile and its contents will be filled during
compilation. A listing of all the files in this example is shown below</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">src</span><span class="o">/</span><span class="n">host</span><span class="o">.</span><span class="n">cpp</span>
<span class="n">src</span><span class="o">/</span><span class="n">krnl_vadd</span><span class="o">.</span><span class="n">cpp</span>
<span class="n">src</span><span class="o">/</span><span class="n">krnl_vmul</span><span class="o">.</span><span class="n">cpp</span>
</pre></div>
</div>
</div>
<div class="section" id="command-line-arguments">
<h2>COMMAND LINE ARGUMENTS<a class="headerlink" href="#command-line-arguments" title="Permalink to this headline">¶</a></h2>
<p>Once the environment has been configured, the application can be
executed by</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">vmulvadd</span> <span class="o">&lt;</span><span class="n">krnl_vmul</span> <span class="n">XCLBIN</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">krnl_vadd</span> <span class="n">XCLBIN</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="multiple_cus_asymmetrical.html" class="btn btn-neutral float-right" title="Vector Addition ~ Asymmetrical Multiple Compute Units" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="host_global_bandwidth_5.0_shell.html" class="btn btn-neutral float-left" title="host_global_5.0_shell" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Xilinx Inc.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>